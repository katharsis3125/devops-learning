name: CI

on:
  push:
    branches: ["**"]
  pull_request:

jobs:
  lint:
    name: Lint (shellcheck)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install shellcheck
        run: sudo apt-get update && sudo apt-get install -y shellcheck

      - name: Shellcheck
        run: shellcheck *.sh

  test:
    name: Test (run scripts)
    runs-on: ubuntu-latest
    needs: lint
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Run kinit.sh
        run: bash kinit.sh

  deploy:
    name: Deploy (demo)
    runs-on: ubuntu-latest
    needs: test
    if: github.ref == 'refs/heads/main'
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: "Deploy to /tmp/deploy (demo)"
        run: |
          mkdir -p /tmp/deploy
          cp kinit.sh /tmp/deploy/
          echo "Deployed kinit.sh to /tmp/deploy"

